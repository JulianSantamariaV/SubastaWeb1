@model IEnumerable<SubastaWeb.Models.Producto.Producto>

<h2>Subastas</h2>

<table class="table">
    <thead>
        <tr>
            <th>Título</th>
            <th>Descripción</th>
            <th>Imagen</th>
            <th>Precio Inicial</th>
            <th>Fecha de Caducidad</th>
            <th>Tiempo Restante</th>
            <th>Realizar Oferta</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var item in Model)
        {
            <tr>
                <td>@Html.DisplayFor(modelItem => item.Titulo)</td>
                <td>@Html.DisplayFor(modelItem => item.Descripcion)</td>
                <td><img src="@item.ImgUrl" alt="@item.Titulo" style="width:100px; height:auto;" /></td>
                <td>@Html.DisplayFor(modelItem => item.PrecioInicial)</td>
                <td>@Html.DisplayFor(modelItem => item.FechaCaducidad)</td>

                <td>
                    <div class="countdown" id="countdown-@item.IdProducto">00:00</div>
                    <script>
                        // Aquí puedes añadir un script para calcular el tiempo restante
                        const endTime = new Date(Date.now() + 5 * 60 * 1000); // Ejemplo para 5 minutos
                        const countdownElement = document.getElementById('countdown-@item.IdProducto');

                        const updateCountdown = () => {
                            const now = new Date();
                            const distance = endTime - now;

                            if (distance < 0) {
                                countdownElement.textContent = "00:00";
                                clearInterval(timer);
                                return;
                            }

                            const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                            const seconds = Math.floor((distance % (1000 * 60)) / 1000);
                            countdownElement.textContent = `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}`;
                        };

                        const timer = setInterval(updateCountdown, 1000);
                    </script>
                </td>
                <td>
                    <form asp-controller="Producto" asp-action="RealizarOferta" method="post">
                        <input type="hidden" name="idProducto" value="@item.IdProducto" />
                        <input type="number" name="nuevaOferta" placeholder="Nueva Oferta" required />
                        <button type="submit" class="btn btn-success">Pujar</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>
